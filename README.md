# μΉ΄μΉ΄μ¤νμ΄ μ„λ²„ κ°λ°κ³Όμ  - λ©¤λ²„μ‹­ μ„λΉ„μ¤

## κ°λ°ν™κ²½
|SKILL|VERSION|
|--|--|
|Java|21|
|SpringBoot|3.2.5|
|MapStruct|1.5.5|
|MySQL|8.4.4|
|Swagger|2.2.0|
|Redis||
|Redisson|3.23.2|
|Flyway||


## ERD
<img width="1349" height="400" alt="image" src="https://github.com/user-attachments/assets/43448e17-d21b-443e-9564-4dcd31a24b65" />


## μ •λ³΄
### π“ API λ¬Έμ„ (Swagger)

μ• ν”λ¦¬μΌ€μ΄μ… μ‹¤ν–‰ ν›„ μ•„λ URLλ΅ μ ‘μ† κ°€λ¥ :

- `http://localhost:8080/swagger-ui/index.html`
- `http://localhost:8080/docs`

---

### β¨ DTO κ³„μΈµ λ¶„λ¦¬ μ„¤κ³„

#### ν¨ν‚¤μ§€ κµ¬μ΅° μμ‹
```
presentation
β”‚
β”β”€β”€ controller
β”β”€β”€ dto
β”‚   β”β”€β”€ request
β”‚   β”‚   β””β”€β”€ PresentationRequestDto.java
β”‚   β””β”€β”€ response
β”‚       β””β”€β”€ PresentationResponseDto.java
β”‚
application
β”‚
β”β”€β”€ service
β”β”€β”€ dto
β”‚   β”β”€β”€ request
β”‚   β”‚   β””β”€β”€ RewardPointRequestServiceDto.java
β”‚   β””β”€β”€ response
β”‚       β””β”€β”€ RewardPointResponseServiceDto.java
```
#### μ„¤κ³„ λ©μ 
|κµ¬λ¶„|λ©μ |
|--|--|
|Presentation DTO|Controller <-> Client λ°μ΄ν„° μ „λ‹¬μ©|
|Application DTO|Controller <-> Service λ°μ΄ν„° μ „λ‹¬μ©|

#### νλ¦„ μμ‹
- Controllerλ” ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ„ Presentation DTOλ΅ λ°›κ³ , μ΄λ¥Ό λ‚΄λ¶€ λ΅μ§μ— λ§λ” Application DTOλ΅ λ³€ν™ν•μ—¬ μ„λΉ„μ¤μ— μ „λ‹¬ν•©λ‹λ‹¤.
- λ°λ€λ΅ μ„λΉ„μ¤ λ΅μ§ κ²°κ³Όλ„ Application DTO β†’ Presentation DTOλ΅ λ³€ν™ν•μ—¬ ν΄λΌμ΄μ–ΈνΈμ— λ°ν™ν•©λ‹λ‹¤.
- λ³€ν™μ€ MapStructλ¥Ό μ΄μ©ν•μ—¬ λ³€ν™ν–μµλ‹λ‹¤.

#### λ¶„λ¦¬μ μ΄μ 
|ν•­λ©|μ„¤λ…|
|--|--|
|κ΄€μ‹¬μ‚¬ λ¶„λ¦¬|ν΄λΌμ΄μ–ΈνΈ μ”μ²­ ν¬λ§·κ³Ό λ‚΄λ¶€ λΉ„μ¦λ‹μ¤ λ¨λΈμ κ²°ν•©μ„ λ°©μ§€ν•©λ‹λ‹¤.|
|μ μ§€λ³΄μμ„± ν–¥μƒ|ν΄λΌμ΄μ–ΈνΈ μ”κµ¬μ‚¬ν•­ λ³€κ²½μ΄ μμ„ λ•, λ‚΄λ¶€ λ΅μ§μ„ μμ •ν•  ν•„μ”κ°€ μ—†μµλ‹λ‹¤.|
|μ μ—°μ„± μ¦κ°€|λ‹¤μ–‘ν• μ™Έλ¶€ API ν¬λ§·μ„ ν•λ‚μ Application DTOλ΅ λ§¤ν•‘ κ°€λ¥ν•΄ ν™•μ¥μ„±μ΄ λ›°μ–΄λ‚©λ‹λ‹¤.|
|ν…μ¤νΈ μ©μ΄μ„±|λ‚΄λ¶€ λ΅μ§ ν…μ¤νΈ μ‹ μ™Έλ¶€ ν¬λ§·μ— μν–¥μ„ λ°›μ§€ μ•μΌλ―€λ΅ λ‹¨μ„ ν…μ¤νΈκ°€ κ°„λ‹¨ν•©λ‹λ‹¤.|
|λ„λ©”μΈ λ¨λΈ λ³΄νΈ|μ™Έλ¶€μ— λ„λ©”μΈ κµ¬μ΅°κ°€ λ…Έμ¶λμ§€ μ•μ•„ λ³΄μ•μ„±κ³Ό μ•μ •μ„±μ΄ μ¦κ°€ν•©λ‹λ‹¤.|

---

### β—μμ™Έ μ²λ¦¬ κµ¬μ΅°

#### κµ¬μ„± μ”μ†
1. BaseErrorCode μΈν„°νμ΄μ¤
```java
public interface BaseErrorCode {
    String getErrorCode();   // μ‹μ¤ν… λ‚΄λ¶€ κ³ μ  μ—λ¬ μ½”λ“
    String getMessage();     // μ‚¬μ©μμ—κ² μ „λ‹¬ν•  λ©”μ‹μ§€
    HttpStatus getStatus();  // HTTP μ‘λ‹µ μƒνƒ μ½”λ“
}
```

2. enum (μμ‹. MemberErrorCode)
```java
@Getter
@RequiredArgsConstructor
public enum MemberErrorCode implements BaseErrorCode {
    ALREADY_EXISTS("M-001", "μ΄λ―Έ μ΅΄μ¬ν•λ” μ•„μ΄λ””μ…λ‹λ‹¤.", HttpStatus.ALREADY_REPORTED),
    NO_SUCH_SHA_256("M-002", "SHA-256 μ•κ³ λ¦¬μ¦μ„ μ°Ύμ„ μ μ—†μµλ‹λ‹¤.", HttpStatus.NOT_FOUND),
    NOT_FOUND("M-003", "μ΅΄μ¬ν•μ§€ μ•λ” μ μ €μ…λ‹λ‹¤.", HttpStatus.NOT_FOUND);
    
    private final String errorCode;
    private final String message;
    private final HttpStatus status;
}
```
- μ—λ¬ μ½”λ“(M-001 λ“±) λ¥Ό λ¶€μ—¬ν•μ—¬ λ΅κ·Έ, ν΄λΌμ΄μ–ΈνΈ λ©”μ‹μ§€, API μ‘λ‹µμ— κ³µν†µλ κΈ°μ¤€μ„ μ κ³µν•©λ‹λ‹¤.
- κ° λ„λ©”μΈλ³„λ΅ Enumμ„ λ”°λ΅ λ§λ“¤μ–΄ λ¨λ“ν™”ν•κ³  κ΄€λ¦¬ν•©λ‹λ‹¤. (μ: StoreErrorCode, PointErrorCode λ“±)

3. μ—λ¬ μ‘λ‹µ μμ‹
```java
{
  "errorCode": "M-003",
  "status": 404,
  "message": "μ΅΄μ¬ν•μ§€ μ•λ” μ μ €μ…λ‹λ‹¤."
}
```
- ν΄λΌμ΄μ–ΈνΈλ” errorCodeλ΅ μμ™Έλ¥Ό κµ¬μ²΄μ μΌλ΅ λ¶„κΈ° μ²λ¦¬ν•  μ μμµλ‹λ‹¤.
- λ©”μ‹μ§€λ” μ‚¬μ©μμ—κ² μ „λ‹¬ κ°€λ¥ν• ν•νƒλ΅ κµ¬μ„±ν•©λ‹λ‹¤.

#### μ¥μ 
|ν•­λ©|μ„¤λ…|
|--|--|
|**μΌκ΄€λ μμ™Έ μ‘λ‹µ ν¬λ§·**|λ‹¤μ–‘ν• μμ™Έ μƒν™©μ—λ„ λ™μΌν• ν•νƒλ΅ μ‘λ‹µ μ²λ¦¬|
| **λ””λ²„κΉ… μ©μ΄**|κ³ μ ν• `errorCode`λ΅ λΉ λ¥Έ μ›μΈ μ¶”μ  κ°€λ¥|
| **μ μ§€λ³΄μ νΈλ¦¬** |λ„λ©”μΈλ³„λ΅ `ErrorCode Enum`μ„ κ΄€λ¦¬ν•μ—¬ λ³€κ²½μ΄ μ©μ΄|
| **ν™•μ¥μ„±**|μƒλ΅μ΄ μμ™Έ μΌ€μ΄μ¤κ°€ μƒκ²¨λ„ μ‰½κ² μ¶”κ°€ κ°€λ¥|

#### μ μ© λ°©μ‹
- μ„λΉ„μ¤ λλ” λ„λ©”μΈ κ³„μΈµμ—μ„ μμ™Έκ°€ λ°μƒν•  κ²½μ°, throw new GlobalException(MemberErrorCode.NOT_FOUND) λ°©μ‹μΌλ΅ μ‚¬μ©ν•©λ‹λ‹¤.
- κ³µν†µ ExceptionHandler(@RestControllerAdvice)μ—μ„ BaseErrorCode κΈ°λ°μΌλ΅ μ‘λ‹µ κ°μ²΄λ¥Ό κ°€κ³µν•μ—¬ ν΄λΌμ΄μ–ΈνΈμ— λ°ν™ν•©λ‹λ‹¤.

---

### π†” μ‚¬μ©μ ID μƒμ„±κΈ° (UserIdGenerator)

#### λ©μ 
νμ› κ°€μ… μ‹ κ³ μ ν• 9μλ¦¬ μ«μν• μ‚¬μ©μ IDλ¥Ό μƒμ„±ν•κΈ° μ„ν•΄ Redisμ μ›μ μ—°μ‚°μ„ ν™μ©ν•©λ‹λ‹¤.

UUIDλ‚ DB Auto-Increment λ€μ‹ , ν΄λ¬μ¤ν„° ν™κ²½μ—μ„λ„ μ•μ „ν•κ² μ‚¬μ©ν•  μ μλ” λ°©μ‹μΌλ΅ μ„¤κ³„ν–μµλ‹λ‹¤.

#### κµ¬ν„ λ°©μ‹
```java
public class UserIdGenerator {
    private static final String USER_ID_KEY = "user:id:seq";
    private final RedisTemplate<String, Object> redisTemplate;

    public String generateUserId() {
        Long nextId = redisTemplate.opsForValue().increment(USER_ID_KEY); // Redis INCR
        return String.format("%09d", nextId); // 9μλ¦¬ λ¬Έμμ—΄ λ°ν™ (ex. 000000001)
    }
}
```
- Redisμ INCR λ…λ Ήμ„ μ΄μ©ν•μ—¬ user:id:seq ν‚¤μ κ°’μ„ 1μ”© μ¦κ°€μ‹ν‚µλ‹λ‹¤.
- μ¦κ°€λ κ°’μ„ String.format("%09d", nextId)λ΅ 9μλ¦¬ μ«μ λ¬Έμμ—΄λ΅ ν¬λ§·ν•©λ‹λ‹¤.
- μ²« λ²μ§Έ μƒμ„±λ IDλ” 000000001λ¶€ν„° μ‹μ‘ν•©λ‹λ‹¤.

#### μ‚¬μ© μ΄μ 
|ν•­λ©|μ„¤λ…|
|--|--|
|μ›μμ„± λ³΄μ¥|Redisμ INCR λ…λ Ήμ€ μ›μμ μΌλ΅ μ²λ¦¬λμ–΄ λ‹¤μ¤‘ μΈμ¤ν„΄μ¤ ν™κ²½μ—μ„λ„ μ¶©λ μ—†μ΄ ID μƒμ„± κ°€λ¥|
|κ°„λ‹¨ν• κ΄€λ¦¬|DB ν…μ΄λΈ” μ—†μ΄ Redis ν‚¤ ν•λ‚λ΅ κ°„λ‹¨ν•κ² ID μ‹ν€€μ¤ κ΄€λ¦¬|
|κ°€λ…μ„± λ†’μ€ ID|9μλ¦¬ μ«μ ν•νƒλ΅ μ‚¬μ©μμ—κ²λ„ λΉ„κµμ  μ½κΈ° μ‰¬μ΄ ID μ κ³µ|
|κ³ μ„±λ¥|Redisλ¥Ό μ‚¬μ©ν•μ—¬ λΉ λ¥Έ ID μƒμ„±μ΄ κ°€λ¥ν•λ©°, DB λ¶€ν•λ¥Ό μ¤„μ„|

#### ν™•μ¥μ„±
- μ΄λ‹Ή μμ² κ±΄μ μ”μ²­μ—λ„ λ³‘λ© μ—†μ΄ μ²λ¦¬ κ°€λ¥ν•λ©°, λ¶„μ‚° μ„λ²„ ν™κ²½μ—μ„λ„ μ¶©λ μ—†λ” μ μ € ID λ°κΈ‰μ΄ κ°€λ¥ν•©λ‹λ‹¤.
- ν–¥ν›„ μ„λΉ„μ¤κ°€ μ»¤μ Έλ„, λ λ””μ¤ ν΄λ¬μ¤ν„° ν™•μ¥μΌλ΅ μ‰½κ² λ€μ‘ κ°€λ¥ν•©λ‹λ‹¤.
  
---

### β… λ°”μ½”λ“ μƒμ„± λ°©μ‹

#### κ³Όμ •
10μλ¦¬ κ³ μ  μ«μ λ°”μ½”λ“λ” λ‹¤μκ³Ό κ°™μ€ κ³Όμ •μ„ ν†µν•΄ μƒμ„±λ©λ‹λ‹¤:

1. UUID μƒμ„±
- UUID.randomUUID()λ¥Ό μ‚¬μ©ν•΄ λ¬΄μ‘μ„ UUID λ¬Έμμ—΄μ„ μƒμ„±ν•©λ‹λ‹¤.
  
2. SHA-256 ν•΄μ‹ μ μ©
- UUID λ¬Έμμ—΄μ— SHA-256 μ•κ³ λ¦¬μ¦μ„ μ μ©ν•΄ κ³ μ • κΈΈμ΄μ ν•΄μ‹ λ°”μ΄νΈ λ°°μ—΄μ„ μ–»μµλ‹λ‹¤.

3. μ«μ λ³€ν™ λ° μλ¦Ώμ μ ν•
- ν•΄μ‹ κ°’μ„ BigIntegerλ΅ λ³€ν™ν• λ’¤, 10^10μΌλ΅ λ¨λ“λ¬ μ—°μ‚°μ„ μν–‰ν•΄ 10μλ¦¬ μ«μλ¥Ό μƒμ„±ν•©λ‹λ‹¤.
- String.format("%010d", number)λ΅ μ•μλ¦¬λ¥Ό 0μΌλ΅ μ±„μ› κ³ μ •λ 10μλ¦¬ μ«μλ΅ λ°ν™ν•©λ‹λ‹¤.

μμƒ κ²°κ³Ό : "0119283472"

#### κ³ μ μ„± λ° μ¶©λ κ°€λ¥μ„±
μ¶©λ κ°€λ¥μ„± 
- UUIDμ™€ SHA-256 ν•΄μ‹μ μ΅°ν•©μΌλ΅ μƒμ„±λ κ°’μ€ μ΄λ΅ μ μΌλ΅ λ§¤μ° λ†’μ€ κ³ μ μ„±μ„ κ°€μ§‘λ‹λ‹¤.
- 10μλ¦¬ μ«μ μ ν•μΌλ΅ μΈν•΄ μ™„μ „ν• ν•΄μ‹ μ •λ³΄λ¥Ό μ‚¬μ©ν•μ§€ λ»ν•΄ κ·Ήλ‹¨μ μΌλ΅ λ‚®μ€ ν™•λ¥ λ΅ μ¤‘λ³µ κ°€λ¥μ„±μ€ μ΅΄μ¬ν•μ§€λ§ μ‚¬μ‹¤μƒ μ μΌν• κ°’μΌλ΅ κ°„μ£Όν•  μ μμµλ‹λ‹¤.

#### μμ™Έ μ²λ¦¬
- SHA-256 μ•κ³ λ¦¬μ¦μ΄ μ§€μ›λμ§€ μ•μ„ κ²½μ° GlobalException(MemberErrorCode.NO_SUCH_SHA_256)μ„ ν†µν•΄ μμ™Έκ°€ λ°μƒν•©λ‹λ‹¤.

---

π“ ν¬μΈνΈ μ λ¦½ λ‚΄μ—­ κΈ°λ΅μ„ μ΄λ²¤νΈ κΈ°λ°μΌλ΅ λ¶„λ¦¬ν• μ΄μ 

#### μ±…μ„ λ¶„λ¦¬
- ν¬μΈνΈ μ λ¦½μ€ μ‚¬μ©μμ™€ μ—°κ΄€λ ν•µμ‹¬ λΉ„μ¦λ‹μ¤ λ΅μ§μ…λ‹λ‹¤. </br>
  ν•μ§€λ§, ν¬μΈνΈ μ λ¦½ λ‚΄μ—­μ€ κ°μ‚¬/μ΅°ν λ“±μ λ³΄μ΅° κΈ°λ¥μ…λ‹λ‹¤. </br>
  μ΄ λ‘ κΈ°λ¥μ„ λ™μΌ νΈλμ­μ…μΌλ΅ λ¬¶μ„ κ²½μ°, λ‚΄μ—­ μ €μ¥ μ‹¤ν¨ μ‹ μ „μ²΄ νΈλμ­μ…μ΄ λ΅¤λ°±λμ–΄ ν•µμ‹¬ λΉ„μ¦λ‹μ¤ λ΅μ§κΉμ§€ μν–¥μ΄ κ° μ μλ” μ μ„ κ³ λ ¤ν–μµλ‹λ‹¤.

#### μ¥μ•  κ²©λ¦¬
- μ λ¦½ λ‚΄μ—­ μ €μ¥μ€ `@TransactionalEventListener(phase = AFTER_COMMIT)`μ„ ν†µν•΄ λ©”μΈ νΈλμ­μ…μ΄ μ •μƒ μ»¤λ°‹λ ν›„μ— λ™μ‘ν•©λ‹λ‹¤. </br>
μ΄λ΅ μΈν•΄ μ λ¦½ λ‚΄μ—­ μ €μ¥ μ¤‘ μμ™Έκ°€ λ°μƒν•λ”λΌλ„, ν¬μΈνΈ μ λ¦½ μμ²΄λ” μν–¥μ„ λ°›μ§€ μ•μµλ‹λ‹¤. </br>
μ‚¬μ©μ κ²½ν—κ³Ό λ°μ΄ν„° λ¬΄κ²°μ„± μΈ΅λ©΄μ„ κ³ λ ¤ν•μ€μµλ‹λ‹¤.

#### νΈλμ­μ… λ²”μ„ μµμ†ν™”
- ν¬μΈνΈ μ λ¦½ νΈλμ­μ…μ€ μ§§κ² μ μ§€λλ©°, μ΄ν›„ λ΅κΉ…μ€ λ³„λ„ νΈλμ­μ…μ—μ„ μ²λ¦¬λ©λ‹λ‹¤.
